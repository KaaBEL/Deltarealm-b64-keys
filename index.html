<!DOCTYPE html>
<!-- v.1.1.3 -->
<!-- version: [github release/new encoding, end, change, partial change] -->
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="color-scheme" content="light dark">
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Tool for Dealtarelm ship base64 keys</title>
  <meta name="description" content="Convert your Dr ships between ship's base64 key, share them throught messages and more. For Deltarealm see Droneboi discord server."/>
  <link rel="icon" type="image/x-icon" href="./favicon.ico"/>
  <link rel="shortcut icon" type="image/png" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAGFJREFUOE9j/A8EDFgAIxBgE0cXY8RlAEwhIYPgBqArhBlMtgEgFxBjCE4X0MQAZBfB2ficiS6HLcBJ8gKyAbDAJcsA5JghKRqxeZekhESSAdgSEFYDiEnv+NQQlWEGtwEASjlwCe0PD/kAAAAASUVORK5CYII="/>
  <script type="application/ld+json">{"@context":"https://schema.org/","@type":"WebPage","name":"Deltarealm base64 keys","alternateName":"Dr Compressor - tool for Dealtarelm ship base64 keys","dateModified":"2023-10-15","additionalType":"SoftwareApplication","applicationSubCategory":"Feature Prototype","description":"html document file, tool for offline use, demonstration and source code of (a space themed sandbox Game in alpha - Deltarealm) base64 ship format - a compressed code representing spacecraft creation. Also a hobbyist programmer project (a show work), testing various features like this text being part of \"structured data\".","fileSize":"69KB","isPartOf":{"@type":"VideoGame","name":"Deltarealm","gamePlatform":"Android","softwareVersion":"0.1.2","genre":["Sandbox","3D","Space","Open World"],"author":{"@type":"Organization","name":"Rizen Planet Studios","url":"https://rizenplanet.com"}},"archivedAt":"https://github.com/KaaBEL/Deltarealm-b64-keys/commits/main","author":{"@type":"Person","name":"KaaBEL","image":"https://avatars.githubusercontent.com/u/85890091","gender":"Male","email":"som.kaabel@gmail.com","nationality":{"@type":"Country","name":"Slovakia","geo":{"@type":"GeoShape","addressCountry":"SK"},"hasMap":"https://www.google.com/maps/place/Slovakia/"}},"isAccessibleForFree":true}</script>
  <meta name="theme-color" content="#333333">
  <link rel="manifest" type="application/manifest+json" href="http://localhost:5500/Deltarealm-b64-keys/webapp/manifest.json">
  <style type="text/css" media="all">@media(max-width:850px){body.still .RL-divide{max-width:480px;overflow-x:scroll;}body.still #info{max-width:480px;left:0 !important;}}body{margin:0px;background-color:#000;color-scheme:dark;}.none{display:none!important;}.mrgn10{margin:10px;}.pad0{padding:0!important;border:1px solid white;}canvas{image-rendering:-o-pixelated;image-rendering:pixelated;}.RL-divide{display:flex;flex-direction:row;width:fit-content;align-items:stretch;padding:10px;}.CMD-chat{width:330px;margin-top:4px;position:relative;display:flex;display:-webkit-box;display:-ms-flexbox;-webkit-box-orient:vertical;-ms-flex-direction:column;flex-direction:column;color:#fff;font-family:monospace, sans-serif, Courier, Consolas;font-size:16px;overflow-wrap:break-word;word-break:break-all;}.CMD-log-outer{width:330px;min-height:0;position:relative;-ms-flex:1 1 auto;flex:1 1 auto;-webkit-box-flex:1;overflow-y:auto;overflow-x:hidden;background-color:#323232;}.CMD-log-view{min-width:0;min-height:0;position:absolute;top:0;bottom:0;left:0;right:0;overflow:hidden scroll;}.CMD-log-tobottom{min-height:100%;position:relative;display:flex;flex-direction:column;justify-content:flex-end;align-items:stretch;-ms-flex-direction:column;-ms-flex-pack:end;-ms-flex-align:stretch;-webkit-box-align:stretch;-webkit-box-direction:normal;-webkit-box-orient:vertical;-webkit-box-pack:end;}.CMD-log-fit{min-height:0;}.CMD-log{height:fit-content;width:313px;padding:5px 0;}.CMD-log>div,.CMD-log section>div{padding:4px 10px;}.CMD-line-bar{width:320px;padding:10px 0 10px 10px;background-color:#242424;}.CMD-line{width:310px;max-height:150px;padding-right:10px;outline:none;}.CMDscrl{overflow-y:auto;overflow-x:hidden;}.CMDscrl::-webkit-scrollbar{width:17px;background-color:#0000;}.CMDscrl::-webkit-scrollbar-thumb{width:17px;background-color:#111;}.red{background-color:#510;color:#faa;}.yel,.CMD-log button.yel{background-color:#440;color:#ffa;}.grn{background-color:#150;color:#afa;}._13{transform:translateY(3.85px);}input{width:calc(100% - 10px);height:16px;border:none;background-color:#242424;color:#bbb;font-size:16px;font-family:monospace,sans-serif,Courier,Consolas;}.CMD-log .inp a{display:inline-block;height:21px;padding:7px 5px 4.5px 5px;}.inp span{line-height:31.4px;display:content;}.CMD-log div>div,input,.CMD-log a,.CMD-log h2{padding:5px;min-height:0;max-height:99999px}.CMD-log button,.CMD-log a{height:32px;border:none;background-color:#505050;color:#fff;font-size:16px;font-family:monospace,sans-serif,Courier,Consolas;white-space:nowrap;}.CMD-log button:hover,.CMD-log button:focus,.CMD-log a:hover,.CMD-log a:focus{background-color:#5f5f5f;}.CMD-log button:active,.CMD-log a:active{background-color:#454545;user-select:none;}.CMD-log .inp{width:calc(100% - 10px);min-height:0px;max-height:999999px;padding:0 5px;background-color:#242424;color:#bbb;font-size:16px;font-family:monospace,sans-serif,Courier,Consolas;}.inps{display:flex;gap:10px;overflow-wrap:normal;word-break:keep-all;}.CMD-log .inps div{padding:0;}.CMD-log .inps div h3{padding:0 0 5px 5px;}.narrow {width:70px;}input[type="color"]{height:29px;width:111%;padding:0 3px;}.wide{width:50%;}.inp button,.inp a{position:relative;left:-5px;top:0;}.loadbox{width:300px;height:32px;position:fixed;top:50%;right:50%;transform:translate(50%,50%);background-color:#111;}div.loading{width:fit-content;height:fit-content;padding:0;position:relative;background-color:#505050;}div.loading div:nth-child(1){height:100%;padding:0;position:absolute;top:0;left:0;background-color:#474;transition:0.15s;}div.loading div:nth-child(2){width:fit-content;padding:1.5px 1px 1.5px;height:19px;z-index:1;position:relative;background-color:#0000;text-align:start;align-self:start;}.CMD-line span{font-size:32px;}.CMD-chat.corr0 .inp button{color:auto;}body .CMD-chat.corr0,.CMD-chat.corr0 button,.CMD-chat.corr0 a,.CMD-chat.corr0 input,.CMD-chat.corr0 span{font-size:12px;}.CMD-chat.corr0 .inp span{line-height:24px;}.CMD-chat.corr0 .inp a{height:20px;padding-bottom:5px;}.CMD-chat.corr1 div.loading div:nth-child(2){padding:2px 1px 1px;}.CMD-log .link,.CMD-log .link:hover,.CMD-log .link:focus{background-color:inherit;}#nothing_to_see_here{background-color:#000;width:100%;height:100%;position:fixed;top:0;left:0px;z-index:999;}#nothing_to_see_here svg{width:100%;}#info,#ntsh{width:calc(100%-20px);margin:0 10px 0 10px;position:absolute;color:#999;font-size:1em;text-align:center;}#info a{color:#77b;}#info a:visited{color:#95c;}#info p{max-width:1080px;margin:0 auto 1em auto;}#info svg{vertical-align:middle;}#info pre{display:inline-block;padding-left:5px;padding-right:21%;margin:0;}#info span{white-space:nowrap;}.number{color:#bda;}.corrs button,.corrs .inp a{background:#f20;filter:grayscale(1);}.corrs .CMD-log-outer::before,.corrs #bg::before{content:"";width:100%;height:100%;position:absolute;background:#b08;filter:grayscale(1);}.corrs button:active,.corrs .inp a:active{background:#02f;}.corrs .inp,.corrs div#bg::before{background:#50f;color:#1f0;filter:grayscale(1);}.string{color:#c97;}.corrs input,.corrs #bg{position:relative;background:#0000;}#bg{padding:0;}.corrs{--cbase:brightness(9)invert(.324)sepia(5);}.corrs .number{filter:var(--cbase)hue-rotate(53deg);}.corrs .string{filter:var(--cbase)hue-rotate(50rad)brightness(.71)contrast(1.6);}main,section,article,h2,h3,output{padding:0;margin:0;border:none;font-family:inherit;font-size:inherit;font-weight:inherit;}h3{display:inline-block;}</style>
</head>
<body onload="init();">
  <div class="RL-divide"><div id="11"><canvas id="0" class="_13" width="480" height="560"></canvas></div><div id="45" class="CMD-chat"><div class="CMD-log-outer"><div class="CMD-log-view CMDscrl"><div class="CMD-log-tobottom"><main><div id="12" class="CMD-log"><section><div><h2 title="mostly for base64">input:</h2><div id="bg"><input id="1" title="typical input element to not flood console with long strings"/></div></div><div><h2 title="for opening Deltarealm json ships">file input:</h2><div class="inp"><button id="3">Upload</button><span></span></div></div></section><section><div><h2 title="some of what the code can be used for">ship functions:</h2><button id="4" title="sets shipt to one from base64">Load ship from Base64</button><div></div><button id="5" title="sets ship to one from file">Load ship from JSON file</button><div></div><button id="6" title="sets input to base64 of actual ship (variable ship can be accesed in console)">base64 of ship</button><div></div><button id="7" title="sets file output to actual ship json than drawed ship png">JSON file of ship</button></div><div><h2 title="name of actual ship">ship.name:</h2><div id="bg"><input id="15" class="string" type="text" title="encodes ship with this ship.name (just edits name)"/></div><div><h3 id="l28">ship size:</h3> <output aria-labelledby="l28"><span id="28" class="number">0</span></output> blocks</div></div><div class="inps" title="inputs for my drawShip function"><div id="l16" class="narrow"><h3>width:</h3><div id="bg"><input id="16" class="number" type="number" aria-labelledby="l16"/></div></div><div id="l17" class="narrow"><h3>height:</h3><div id="bg"><input id="17" class="number" type="number" aria-labelledby="l17"/></div></div><div class="wide"><h3>backg.-color:</h3><div id="bg"><input id="18" class="string" type="text" aria-label="ship background color:"/></div></div></div></section><section><div><h2 title="after clicking JSON file of ship file waits here to be downloaded throught download link">file output:</h2><div class="inp"><a id="8" class="none" title="doubleclick to download 2 instantly (xD)">Download</a><span>no file to download</span></div></div></section><section><div title="417kB of ships within 69.6kB of html with its coding and decoding" id="9"><h2>my ships:</h2></div><div><h2 title="some of what the code can be used for">for ships:</h2><button id="19" title="sets 'my ships' to ships from multiple JSON files">Load ships from files</button><div></div><button id="20" title="sets 'my ships' ships from first csv file">Load ships from csv file</button><div></div><button id="21" title="adds loaded ship to 'my ships'">add ship to ships</button><div></div><button id="22" title="sets file output to csv file of all of 'my ships'">csv file of all ships</button></div></section><section><div title="Loads its source throught http request then it can be Downloaded for offline use"><h2>HTML document:</h2><div id="26" class="inp none"><a href="Dr_v.1.1.2_keys_tool.html" download="Dr_keys_tool.html">Download</a><span>Dr_keys_tool.html</span></div><button id="27">Load file</button><div>downloads this site for offline use</div></div><div><h2>encoding code and guide:</h2><a class="link" title="Brings to source code on github, where instructions/guide is." href="https://github.com/KaaBEL/Deltarealm-b64-keys/tree/main">Link to GitHub repository</a></div></section></div></main></div></div></div><div class="CMD-line-bar"><div id="13" contenteditable="true" class="CMD-line CMDscrl"><span></span><span style="color: #999; font-size: 16px;">not working command line</span><span></span></div><div class="CMD-line-btns none">comming spoon</div></div></div><input id="2" class="none" type="file" multiple/></div>
  <footer><div id="info"><article><p><a href="https://rizenplanet.com/deltarealm.html">Deltarealm</a> (shortly Dr) is space themed sandbox open world mobile game developed by <a href="https://rizenplanet.com/">Rizen Planet Studios</a> (currently partialy availible on android from <a href="https://discord.com/invite/9S6PG9DgDm">Droneboi Discord</a>). It reached only alpha testing so far (version 0.1.2) and later after long pause in development a new vesion has been worked on. However It still waits for brighter future, because It was temporarily canceled due to size of that project.</p><p>I made this tool so players can convert their creations (spaceships) to base64 codes and share them through shorter text key, as it is in Droneboi (classic). This is so far only prototype version for test porpouses. Instructions for it's use can be found here: <a href="https://github.com/KaaBEL/Deltarealm-b64-keys/tree/main#some-instructions-for-use-of-the-tool-ui">https://github.com/KaaBEL/Deltarealm-b64-keys/</a></p><footer><div itemscope itemtype="https://schema.org/WebPage">Made by: <a href="https://github.com/KaaBEL"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="16" height="16" viewBox="0,0,16,16"><g data-paper-data="{&quot;isPaintingLayer&quot;:true}" fill-rule="nonzero" stroke="none" style="mix-blend-mode: normal"><path d="M8,0c4.416,0 8,3.576 8,8c0,4.416 -3.576,8 -8,8c-4.416,0 -8,-3.576 -8,-8c0,-4.416 3.576,-8 8,-8z" fill="#f9c00f"/><path d="M3,2h5v4h4v-4h1v5h-2l2,7h-1.3l-2,-7h-1.7v7h-5z" fill="#000"/></g></svg><pre>KaaBEL</pre></a><span itemprop="dateModified" content="2023-10-15">Last updated: <time datetime="2023-10-15">October 15, 2023</time></span></div></footer></article></div></footer><div id="nothing_to_see_here"><svg id="ntsh" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="750" height="160" viewBox="0,0,750,160" onload="ntsh();"><text transform="translate(32,64)" font-size="32" font-weight="bold" xml:space="preserve" fill="rgb(128,128,128)" font-family="sans-serif" text-anchor="start"><tspan x="0" y="0">This tool can not run without javascript enabled </tspan><tspan x="0" dy="48">there is nothing to see here.</tspan><tspan dx="0" dy="0" font-family="Courier"> >:)</tspan></text></svg></div>
  <script>
    "use strict";
    function GE(v) {return D.getElementById(typeof v=="number"&&v==v?
      (_ge=v+1)-1:v===UDF?v=_ge++:v)}
    function EL(e) {return D.createElement(e||"div")}
    function NG(p, n, id, cl, ar) {function A(s){if(typeof a[i]=="string"&&
      a[i++])e[s]=a[i-1]}function R(){if(a[i]instanceof Array)for(r=a[i++];
      ++j<r.length;j++){e[r[j-1]]=r[j];e.setAttribute(r[j-1],r[j])}else if(
      a[i])return e.appendChild(D.createTextNode(a[i].data))}var i=0,j=0,
      a=arguments,t=a[i]instanceof Node?a[i++]:0,e=EL(a[i++]),r=[""];
      A("id");A("className");R()||R();return t?t.appendChild(e):e}
    var D = document, UDF = void 0, U = "" + UDF, F = function () {};
    var _ge, hex = {}, canvas = GE(0), input = GE(), finp = GE();
    var uint8array = new Uint8Array(), toDownl = [""], downl = GE(8);
    var CMD = {}, CMDlog = GE(12), CMDline = GE(), shipName = GE(15);
    var canW = GE(), canH = GE(), cBC = GE(), shipSize = GE(28);
    var ctx = canvas.getContext("2d");
    +function (i) {for(;i-- >0;hex[hex[i]="0123456789abcdef"[i]]=i)
      hex["ABCDEFG"[i-10]||0]=i}(16);
    function forEach(f, t) {
      for (var i = 0, l = this.length; i < l; i++)
        if (Object.hasOwnProperty.call(this, i))
          f(this[i], i, this);
    }
    if ([].forEach === UDF)
      Array.prototype.forEach = forEach;
    function hexColor(arr) {
      if(typeof arr === U) arr = [0,0,0];
      for (var i = 0, clr = "#"; i < arr.length; i++)
      clr += "" + hex[arr[i] >> 4] + hex[arr[i] & 15];
      return clr;
    }
    function addClassName(el, s) {
      var i, clss = el.className.split(" ");
      for (i = clss.length; i-- > 0;)
        if (clss[i] === s)
          return !0;
      el.className += s;
      return !1;
    }
    function removeClassName(el, s) {
      var i, clss = el.className.split(" ");
      for (i = 0; i < clss.length && clss[i] !== s;)
        i++;
      if (i === clss.length)
        return !1;
      while (i++ < clss.length)
        clss[i - 1] = clss[i];
      --clss.length;
      el.className = clss.join(" ");
      return !0;
    }
    function addClassList(el, s) {return el.classList.add(s);}
    function removeClassList(el, s) {return el.classList.remove(s);}
    if (EL().classList === UDF)
      var aClass = addClassName, rClass = removeClassName;
    else
      aClass = addClassList, rClass = removeClassList;
    if (typeof ctx === "number") {
      aClass(D.body, "IE5");
      ctx = D.createTextNode("Canvas are not supported.");
      GE(11).appendChild(ctx);
    }
    function args(arg) {
      for (var i = arg.length, a = []; i-- > 0;)
        a[i] = arg[i];
      return a;
    }
    var iT = "innerText", nTS = GE("nothing_to_see_here"), pN = "parentNode";
    CMD.autoScroll = 1;
    function scrollBottom() {
      var b = arguments.length ? arguments[0] : 0;
      if (CMD.autoScroll + b > 1)
        setTimeout(function () {
          CMDlog[pN][pN][pN].scrollTop = CMDlog.offsetHeight;
        }, 0);
    }
    function addCMDLog(strarg, cls, priority) {
      NG(CMDlog, 0, "", cls, {data: args(strarg).join(" ")});
      scrollBottom(priority);
    }
    function consoleAndCMDLog(strarg, cls, priority) {
      var s = args(strarg).join(" ");
      switch (cls) {
        case "": console.log(s); break;
        case "yel": console.warn(s);
        case "red": break;
        default: console.error("Internal Error");
      }
      NG(CMDlog, 0, "", cls, {data: s});
      scrollBottom(priority);
    }
    var message = consoleAndCMDLog;
    CMD.log = function () {
      message(arguments, "", !1);
    };
    CMD.warn = function () {
      message(arguments, "yel", !1);
    };
    CMD.err = function () {
      message(arguments, "red", !0);
    };
    window.onerror = function(m,s,l,c,e){if(e&&e.stack)return CMD.err(m+"\n"+
      e.stack);CMD.err(m+"\n\t"+s+":"+l+":"+c)};
    function del(i) {
      while (++i < this.length)
        this[i - 1] = this[i];
      return --this.length;
    }
    function ntsh() {
      nTS && D.body.removeChild(nTS) ? nTS = null : 0;
    }
    ntsh();
    function evts(l, a) {
      for (a = ["keydown", "mousemove", "click", "touchstart"]; a[0];)
        D[l + "EventListener"](a.pop(), interacted);
    }
    function interacted() {
      var rldiv = GE(11)[pN];
      if (removeClassName(rldiv, "still"))
        GE(45).scrollIntoView(!0);
      evts("remove");
    }
    Date.now() < 17054e8 ? evts("add") : GE(45).scrollIntoView(!0);
  </script><script>
    "use strict";
    CMD.ref = function (typ) {
      for (var ar = arguments, i = 1, s = ""; i < ar.length;)
        s += ar[i++];
      return NG(CMDlog, typ, s && {data: s});
    };
    var file = {input: finp, curr: null, files: [null], open: [0]};
    function fileNames() {
      var i = 0, p, s = "", a = file.files, o = file.open, c = a[0];
      p = o.length > 1 ? "\"" : "";
      while (i < o.length)
        if (c = a[o[i++]])
          s += (i > 1 ? " " + p : p) + c.name + p;
      var names = GE(3).nextSibling;
      names && (names[iT] = s);
    }
    function fileOpener(f_exec, error, f_final, bar, mode) {
      f_final = f_final || F;
      bar = bar || null;
      mode = mode || 0;
      if (!file.open.length)
        return CMD.err("No files chosen");
      var fl_i = file.open[0], succ = 0, st, barE = function (n) {
        fill.style.width = n * 100 + "%";
      }, barF = function () {
        st.width = "100%";
        if (!succ)
          st["background-color"] = "#744";
        setTimeout(function () {
          st.transition = "0.3s";
          st["background-color"] = "#0000";
        }, 130);
        setTimeout(function () {
          var el = fill[pN];
          rClass(el.nextSibling, "none");
          el[pN].removeChild(el);
        }, 400);
      };
      function nextCLi() {
        for (var i = 0, o = file.open; !o.length || fl_i >= o[i];)
          if (++i >= o.length)
            return !1;
        fl_i = o[i];
        return !0;
      }
      function readFile() {
        var reader = new FileReader();
        reader.readAsArrayBuffer(file.files[fl_i]);
        reader.onloadend = function event() {
          if (this.error !== null) {
            if (this.error.name === "NotReadableError")
              CMD.warn("file " + file.files[fl_i].name + " changed");
            else
              CMD.err(this.error + "\nat fileOpener");
            del.call(file.open, fl_i);
            fileNames();
          }
          try {
            var ar = new Uint8Array(this.result),
              next = f_exec(ar, mode, file.files[fl_i]);
          } catch (e) {
            next = !!CMD.err(e.message || e, " fileOpener:?", e.stack || "");
          }
          barE(fl_i / file.open.length, succ |= !next);
          if (next || mode)
            if (nextCLi())
              return readFile();
            else
              succ ? f_final() : CMD.err(error), succ;
          else
            f_final();
          barF();
        };
      }
      function pdg(s, px) {
        return bar.style["padding" + s] = px;
      }
      if (bar !== null) {
        var w = bar.offsetWidth, fill = bar;
        NG(bar = NG("", "", "loading"), "");
        NG(fill[pN].insertBefore(bar, fill), "", {data: fill[iT]});
        aClass(fill, "none");
        (st = (fill = bar.childNodes[0]).style).width = "0";
        st.backgroundColor = "#474";
        if (bar.offsetWidth !== w) {
          pdg("", "0px");
          pdg("Left", pdg("Right", (w - bar.offsetWidth >> 1) + "px"));
          rClass(GE(45), "corr1");
          pdg("Top", pdg("Bottom", ""));
        }
      } else
        barE = barF = F;
      readFile();
    }
    function onFile(e) {
      var i = 0, a = this.files, el;
      if (a.length) {
        file.curr = this;
        file.files = [];
        for (file.open = []; i < a.length; i++)
          file.files[file.open[i] = i] = a[i];
        fileNames();
        el = NG("input", "2", "none", ["type", "file", "multiple", true]);
        this[pN].replaceChild(file.input = el, this);
        el.onchange = onFile;
      }
    }
    file.input.onchange = onFile;
    function dragOver(e) {
      e.preventDefault();
    }
    function dragDrop(e) {
      e.preventDefault();
      var i = 0, l = file.files.length, t = e.dataTransfer, a = t.files, f;
      if (a && a.length)
        f = function () {
          return a[i];
        };
      else if ((a = t.items) && a.length)
        f = function () {
          return a[i].getAsFile();
        };
      for (; i < a.length; i++, l++) {
        file.files.push(f());
        file.open.push(l);
      }
      setTimeout(fileNames);
    }

    var myShips = [
      "Klllsec",
      "gAAHS0lJSXNlY4CBAQBoTcVwA6a1C+EOJw+cIIVQoTMBiQlgthMKnAqhQqcCQoRFYUKgAIFAhcAEdGY5BwuoFBYyUCEQCCEyARAEQBAAQYBAZzAaXKY4h8IB0UKcAAsCEgAiEwghCIAgAIIACAKVwgJxwuQAqCBaiBMiIwEgCIQQBEAQAEEABIEKIoR4GS6EywxlQ+hQysFwACQQI8AJ0Qp0LKASSBVGAQoEKBCgQIBCBXFCvBAEShMUChtBB1dWiBcggTghWoACoAMAAADACxABAJgAAAAAcUGAoBAJRGAonUCHDhKEjnUcAAfECtECtBAnQAEA4AUAgCESAZMAAQgRShiQsjFsECXCpwpahRShkR0AEoAW4gUoAF4ADBEKiMw5OhlC4SMHkwwB0AJggAKgMiQQH8TE0KGAznwkIiCBeBwKgUuhUujURwJRKrwGr0wBkCicCBE5QwaQASwQIQSGxgR88oPDAkAVRAhAR+LAAcAiUwBUANDJQXAhBKQlA1gAABQEnRzhAGCxAURABD4SBw4AFpnCAUAhUwAgiEhKBpABLBAgMHQmYJEfHABQBRcC0JE4cACwyBQAFQB0MhFMCBFqySAWCAwNCmjMxyMCCggOgcCkMCl86uOBKBUauQKgU7gQAjOUT4ZQWMjBJUMArAAYAhQAheVheCAgLKpgVXgROtkBAACIFaBT6AAKhgAFBKArnUCKDjKEB+V9pAGGdUwAK8QKAQDECVAAAAAAAEMgAkYBAhAClHCZoKwKK0EHV1YIAB3ECbECrAAFAAAAAAAAAAAAAAAQAwQICoFAZIYCoUEpE8MEsEKUACfECtCxgEKgU5gEKBCgQIACAQogTogVgkAEi3MCrBArxAlRkYAKgkAIQQAEARAEQBAAcUKsDAPCYIZTKBQQIE6GD+EjASAqARAEQBAAQQAEAQoNxGmSgwUUpAACARCVAAgCIAiAIECgM2AwmOaMAqPCofCpgAqBwohAAQKBEIEJ+Mx1KoVK4TMBjwkA0PyB6wE=",
      "Ckamee",
      "gAAGQ2thbWVlgIECAGhO2F4CNHIb7xYD8NMiAQiBmIJLgAAEpmgKhQIgYAhQANMEk8IEcAFggAKYoSkUCgAAAQMRMCIwSTApTAAXwAOAAQogyuEVYNCZkFFhBDgUOoPOhIwKB0Cn0Bl05mNT2AA2gE6hM+jMxqawAWwAADqACwAAgAAAAxRAPQDYAAB0CpfBZSomhQnggQgBNgAAnUJpcJmMTWED2AAAUCgNStFxCYwCBBgwYxAqTBCJKaEAgshYERp40AAMABg6EfAidKZhUsDQoIBGBWwALQgIAAAAuAAAdAABAIYABQRmgMIE8DA0LmBw4AAdMBEgWoAIoAIAAID6AFGhgUqMRwYxQoAA8AIg6GQHBw4AIgAAHFK5wWGgAcRARC4ygBAAAPFROYBIIVoIJhwqhQoiMyUUQBAZG0IHDxqAAQADEbAiNKZhVBgZOhTQqYAVoAEBAQCACwAAAAARAIYIBURmgMII8DB0LoADB+iAiaggWoAIIAQAAID6qCAqNFCIMfgEGHwmZFKYACaFz+AzIZPCBEDhM/jMx6PwAACg8Bl8ZuNReAAAAAAwAAAAEAFgiFBApB4ATAAAKAwGkamoFCqAC+IEmAAAUBgMIpPxKDwAAABQGAwi0TEJECDAYDCSQ+EAGAAiBiIAApMElUIFcAEAwAAFMOdyKBwAEQMUwDRBpVABXAAYoABiaAhAIKaAAAEIAA7thSQC",
      "KIIOneHalf",
      "gAAKS0lJT25lSGFsZoCBAQBoT0oeAqaxC+EOJw+cIIVQoTMBiQlgthMKnAqhQqcCQoRFYUKgAIFAhcAEdGY5BwuoFBYyUCEQCAVSgVAgFQgFUoFQIBUIBTqD0eAyxTkUDogW4gRYEJAAAqlAKJAKhAKpQCiQCoQCqUClsEAAyakAQLQQp0BHAgikAqFAKhAKpAKhQCoQCqQCFUQI8TJcCJcZyobQoZSD4QBIAECcEK1AxwIqgVRhFKBAgAIBCgQoVBAnxAtBoDRBobARdGDlAEgAQJwQLUAHAAAAAAAvQAQAYAIAAAAAiAuCQiQQgaF0Ah06SBA61nEAHAAFxAnRAgAAAOAFAIAhEgGTAAEIEUoYkLIxbBAlwqcKWoUUoZEdABKIFeIFKABeAAyRWUcnQyh85GCSISBWiJcBCohQGRKID2Ji6FBAZz4SEZBAPA6FwKVQKXTqI4EoFV6DV6YASBROhIicIQPIABaIEAJDYwI++cFhAaAKIgSgI3HgAGCRKQAqAOjkILgQAtKSASwAAAqCTo5wALDYACIgAh+JAwcAi0zhAKCQKQAQRCQlA8gAFggQGDoTsMgPDgCoggsB6EgcOABYZAqACgA6mQgmhAi1ZBALBIYGBTTm44EDHAKBSWFS+NTHA1HKFirgMkX5ZAjZQrYHUcaBIwI=",
      "JKmi",
      "gAAESkttaYCBAgBoT5suArjRE/MCSc/jCIFNgAABAgQYvCyQAGQQD0ACAAIEgQBhZBghQAAAAILCZXCBwQVAgcAlwAAZIYMoARIAACBAEOhkgMPiwIEDgAgARAUROXDgwIEDAAAEIoEQYIRIIQCkEAAIRGQEECVAAgAAAAACnQxw4MCBA4AIAEQFETlw4MCBAwAABCKBEGCESCEApBAACERihAwgAQAAAAAACp1BBsCBAwcOACIAAJXCCpA4cODAAUAEQOFSGAESgBQAAIAIgEBkAqPAKHAJECDA4BKFDCABAAAAAAAAnUECkDhw4MABQAQAolLYABIHDhw4AAUAHDhw4EAUQoAQIAUAACAiBxAlQAIAAAAAAJ0McODAgQOACABEBRE5cODAgQMbAAKLAwcOHDgQBQAhRAoBIIVADiBKgAQAAAgQADoZ4MCBAwcAEQCICiJy4MCBAweqMDlw4MCBA1MoFAqIFAJACgEdMoFPgACFDCADoNCwQAaQQCwAAECAABAhhAwhBAgACQAIAJFCBAYJAAAAFBhEZlAITAIECDCIANP8iSMC",
      "Bejj",
      "gAAEQmVqaoCBAgBoT7rUArLSE+0ESc/LCIFNgACEjjwSiAcCBIIAPSqBUYAAhMCskbBA4pA5cACRiUUCsAAUAAsAAAAZwCKwmEPFAhVABQAARIIilcAlwCAwKSQKCUQJUAIAAACggKDwGixikAAsACk4AACRCixmUClUECsAEMgAUohEPQ6ADADAJRCpFBIHDhw4cODAgQMIsBAApCABAACARQ0qgAMgBYMMAERiFofCAXAAZAAgkMqFcJlECwCiBCgBAAAAAKAAAEFhQVhgIABIwWIBAJESLDAQAKSgkAEAIAAdKogWoALIAACASFAEwQWQCBCJFiBz4MCBAwcOHDhwAEEOABRgkQEAAFDAQAQAHDJzCEigAqgAMlCISARABUDhEgkAGUAJACAFAAAAAAAAAAikMgCgAJFIBgAUdEEMIhIAUAEgAoAEAACRaAEyBw4cOHDgwIEDBxCJHAAowCIFAAAADEQABThk5jCQAIAKIAMABhGJAMgAKEQmsQKAKAFKAAAAAAAoAEBQ+Aw+GAgAgEQGkAKASAkGGAgAgEIGAIBAhA4FRApQAWQAAEAkKIJgAiBALTIHDhw4cODAgQMIsBCABQAAAAY1KABSAGCQAYBIzKJQADABZAAgkAqEwSwyhQyiBCgBAAAAUEBQaAwaMSgAAACHDABEKjCYwaRQQKwABQhkACAS9QAAAACB0qyQsUDmwIEDyPV5JAOIRCwKgAIAwAIwAADIAAaBwRwmhQKgAAAAAATzIDAJEGAQoRcygVWAAISGPAqIBQIEggY9CoFJgACECA/5gSUC",
      "inhyg0BG",
      "gAAIaW5oeWcwQkeAgQIAaE/0kAg0cxPnHOOO0waFF6EzKQkLSAACAAAAAAAAAAAAgoB8QaJwAAAAAAAAAAAAEASmLF40kAAkDJ8K2Bg68fEKIHhBQKXQACQKrzqZAF4AAABSgAgAAAAAAAAACAAWgIAgEA8JQAtABBQAFQAAAABSgYV8JAAVRCUGCgAAAACUCicLKAAqgAgAQACwAAQEAXqoFCoIamAFqAAAACCQmpFDYEQIVEAFAAAIAJCKlQSgAgAAAEBKkIqUTKFDBYlCApCggA1gAwgAABAIABAEpqEVeAWogAkghQghJoBKIQFIQMALAOADQABVINgImIBCoQBIwQCACAAAAAAAAAQAAAAAQBCQgwQgAWgBAJADHFIHIOADWAgaucFhAaggKlnAIXUgAkoSUAEAiAAAAAAQAAAgEJiCgwVUABtABcEMZAoZQAYAoIJgSgo1AOCESCEmgAqiQhGtujgNThXQAoBgIipwcQIAwLAoJAANAIWFBSQInwjIGD42kAEsJmBD6FRBC5GJgQoEpA4FwAeQAAAAAOADAAAAwAYAAACAlCEQAYdCpwZaiEoWcEgdgIAPIAEAAABABAAAAAAAAQCABiABoJAAAAMVBDSQKGwOHAB8AClAAZAAAAAQAQAAACAgCMhAwtCpgBaihABQMQRooFIYHThQAZ1BpVABAAAAAEAEEAAAAAAAQSACQoUAoAQA8Qouft0FAgwAwEDkkDoAqABSMVABVAoHQASAoVRoAQCUCiVCICIygBSAwwowAKQEqRioACoWUIGACAAKKFFFpVAxRCAgFYjIQQVQAZQAACiU7CIDyAAANAAAAGBozECikIiADaFTARnDorABdAoLC0gANoUIIRIBFcDikDoASAAAdAANAAAAAAAAiAAApABAAAAAAAAAAFBBVLKAAwfiohWIwMEJAKAAGACogRUgdQDwASANHwGFTAA5yAAiAAAVBFUwAaQOQEADAAAAAAAQOhHQCpSkAEAGEAFgCFRABQEUcOAAAEADAAAAAAAAKgACSABVcLGASoHBJQ4ygMwBQAoQATQAAAAAAACA+KgUBoaJIFIBk0JpUKKBggUUCpdCpHCBi1PhZQGZQEcCKoCOoFMBK8AJQKExyARWFgAAAAAAFFKFFmADAEAEVC6AA4BGoCMDFQAAAAAARAAAAAAAAAAAAAAAUoAKgizgwAEI+MBIBUEUtACRA4APABipIIiCECByAAIaAAAAAHQACDpxkIqDTOESuAAqgIFhAAORAwcAABoA5KACqAASFpDYAGygUogQIpGQAWQOHABEAA0AAAAAAGAhgxq4DC6DSWBCYAYKhULhUAGXQmQyNoVNoEMDhULB0JmABS0kLCBRaBAaFRACbBCZGKgAFgcOABIAAAAAAAAAoAED/HGgAQDQAKQAAAAAAAAAAAAAAAqAACGQAxxSByAgAQAAAABwsQlsAAVAoDCogQ0gcgCQAAAAAAAAUUAAwUYSMoAIAEAFUamCESByAAIaAAAAAACA0IiDlAQAyAAigIIFFAAVwCALOHAAEAE0AAAAAAAAoAIAkAAAoAoihYkgEgsZQOYQOaQAEUADAAAAAAAAiJEK4FK4BC4BAgwug0lhUhgUAoZDoVKYwEUCAIBCJ7AhdCaAwqSQCnwIDSnIAAAAQNChgglgg8jEQAXQAHB4ARIAAAAAAAAAAAAAAAAGAAAAEAwKoUIjAj6AEaAAIAc4pA5AQArQCDQk4AHYAAAAAAAAwQUAAMGgkAGEIOAEKAAAQAGZwgqQOgABFE6DUwQ8ABsAAAAAAAABFAYWUAAUECXEC1BBVGigUJgAUgcgoAIAAADDyTABbAARAAAAQMCm0AAUABhOgBIEVBBkAQcOQEAkBioQMAEAiAAAAABQKpwIkQgIRUMG8AE0Di8IiAhSMVABTAARAAAAAKCAU02UBoHBpDABVAAUToSIFFQAE0AJAIACclGogAzgE0jVSAiRqYEKoIEIIS6AlCFCAUTAA7CABiohg6jMQKVQOWQADUBF0ICDByACAAAAAAAAAAZSUECEABVEJQs4pA4ACAzk4CENAxyIHDgAAFAAkAMcOBABTMEEAvh9YgMCNpCwCXQkoAAoACgMChNEZQY2hcQhA2gAKggioSKYACYCDAMBhEFNUBggUogLoIKoxMppMKiACgAEE5MJfAapWFkJGjIQkYSHNAwmIRP4BKgADI0KWMnCAxABAAAAAACAgWBAB5lCAUBgEAEHwAZQASBIwUIEEgaSUABUEMQAgA2gAgAAJUwME0sYEAZzUBhMApMAg0FhAwAAAACC1CRMJGACGwAAAAEAUtRSKVQAFQCAlCAlx7CQhAOkPAARAAAAAAAMJOUhCQNbWQg2AgQYNjQziLYoAAAAAACAwEBSHgAAAAAAQDCAFQAAAACAViaBiWAioBARQBjAmgAAAAAAMwcR1wh+JgI=",
      "bdyss000",
      "gAAIYmR5c3MwMDCAgQIAaFZfugE4kRPjCGWP4xhSgGQAAIAgJQEhAIIUJJQAAAAgKElACBABAAAADABADlqAEgAAAKAgAgAAAEFKAkIABCk5qABKAAAIOjIQAkQACCJQAABZqABKAAQlGYhIQggQEaSkoSITEQlChhISUJBBZGQBQARwEKRoAAtIQEEGARx0ABEAgIEgkgUAIhgxASCAFiqQkEFkoGCAKEQJUowMPpQwYWQDACIABCkZyMBBChIychDJAgARHJgAUpCQiYcKHqQwYQWIVMmFcIFqhKDhBQBQiYMMREwAGTlIZQGACAQAAA4mMlGRKkTwGiFMGMlDBg5SkLCRg1QWAIjgwAWQwgIgoBMPFTxoYUIKEKmSCGEgZcgIOtSQgYIMIgMHHQAAANABFpCBggwCOOgANgAAA0EqCwBEYALAAhARROigAAkZBFAQQRSiJCJdyMhASNCRiIwUAAgBEKRgoANAFjKACABBSgJCgBAAQUQGMoAOAEFKDkKACAAAAGAgBEAGAABAEIGFCAAAAAQpCQgBQoIUDHQASEMIEAEgiEgBUhACdAQpaYjIBI38iSIC",
      "engiSupport001",
      "gAAOZW5naVN1cHBvcnQwMDGAgQEAaFa+IgG60BP1DGfP6xqBTYDBK5BAlBAgCKQucTlAgYoFKogHAsADQIAbcIBQqsIIQSF1Bw5QolKoAAiUSmgBOoASAAAAAIlCg9CoQwsxOXAAEAEAAACiYocRYnDgMMFDCxODw+UwoUklcAkAkRYihAABoAQAkEBUcsEhdAAQAQAAAIJMcBgc0AA4IBMcOCCTCmKFoCIPQAIAAAAAABQWhA4cKojLYXIAEAEAAACiYocQ4nDgcMHDChOHw+RwoUkhMAkwk0dgFWDQCBQQJQQIAqlLTA5QAAsUEBcEgBeAADfgAOFUhQmCwusOHKBEoTABTAIRThiGIQI=",
      "Kl2ndfinal",
      "gAAKS2wybmRmaW5hbIABAGhW+yACujAT8QwpT+sIhZYhQIEAxaBggQLgUAgQAnM5DAIzh0whY+hE4EXoxOSAeEggQJNCYWIIUCBAJ0gEXhZIIE6FDgUyFsggAJwAHQAAABMAgAhigsBQokECMUAAyBgCEbgECIBYFQ6ISR4AhAALAIWFBRJWKBFKNKgURoAL4ANIAAAAWBhegpehNYlK4XAIHThw4MCBA4XL4EKHRGED6AAARAAgPobABAJTyAA6AA4dAHQIYCICeCQeh9AhMpOJBQqGgJQgA8gATogTAgSATxQyCBAhBIAJFBaACCCDyGQhAIgAQgDgMAEsMFDIQQQQgkhKUMoCgBAsSgAQqTiEDqEDBw4cOHDgACIhicyBAwcOHDhwWCDIBYfQAQ0gg0guOHQOoUMJKy8ECAABOkHGAhnEqfChQMICCUQI8AEAAAAAwAQA4oLAcKJBBrFBAAgZIhGYBAiAWBUKiEseAABYACg0LJCxwolwokGhUABEAAkAAAAAMKQEK8NqEhQ4hA4cOHDgwIFCZBChQ6aQAQAAEAFcEBgiE2AKG0DnAh0AdIhgIgJ4JDaH0CEyk4oFKoYI1SBTwAAFIhSDigUqgEwhQojMpTAYzBwShYShEYEVoRGTB2IjgQZNKoWDIUKBCBPxiSEC",
      "ohmbohmb",
      "gAAIb2htYm9obWKAAQBoWDqAADATM/EMCQ/DEBSYUKBCgQsFUhRYUaBFgRcJI0CBAQUKFDhQ4EWBFAVWFGiRMDoU+FAgQ4ENBVoUeFEgRYEVCaNBgQcFEhRYUGBFgRYFXhRIkTAyFNhQoEOBDwVCFBhRoESBEwkjQYEFBRoUeFBgRIESBU4UCJEwKhS4UCBCgQkFShQ4USBEgREJo0CBAwUCFBhQ4ESBEAVGFCgBFxmapgQ=",
      "bdyss001",
      "gAAIYmR5c3MwMDGAgQIAaFjn8AI4kRPjCmWP4xhSgGwAAIAgJQEhQECQgoUSAAAABCUJCAEiAAAAgAEASEILUAIAAAAURAAAACBISUAIgCAlCRVACQAAQUcGQoAIAEEECgAgDRVACYCgBAMRAHIQAiBIyUNFCiKygGxkpAFaSFhAovAAZBAZWQAQARwEKSnIABIAABsISAEycgCgA4gAAAwEkTwAEIGATQVUACVAAgAAAIgJICKAGiqFAwSkCp1CC5BBZGZgU9ggClARKUQKEwCFV+AVoJAohAKR+cJDGjKyACBTeNlAphAYBAabCNhYQAIQASBIRUEGAAykECVACFAydCpggxgBOlIQyQMAEQhIISYAYKAEaEBARiIqgAgMpBApQAgQAQAAAGIFgCIOhgOAwsUGCoAEIFKgAiBcJBoZQAYAIATIACIAAAAAAADwAgCo5AKACCwAAewAEpACVBAVGIgAgAAAwMEkKiqACBSkABEAEAAAAABkogIAAAAAAAAAEoAIAEFkvpCQg4ygIw8ZQKaQsoFEITKIDDIQEAEAAEAkZADAQAgRAgAoGRoVkEGMABEpSOUBACAgg7gAUjAQAQABHYmoACIwkEG0ACFABAAAAIgUAIqYGCYAChEbqAAAUKACIAykCxk5QNCRh4wFZAotQAaRgYMOAAAAJAFAAgIiAAAAMnIAoAPYAAAMBKk8ABCBgEwFFCAgAgPsfSECAHEBAAEAFoCIAEooFAo10CisABlEpgYmgAiiABUULoUKgMLHAjIACpUA8oWMDIQEHZnISAGAEABBCgY6AKQhA4gAEKQkIAQIARBEZCAD6AAQpCQhBIgAAAAABkIAZAAAAAQRaIgAAABAkJKAECAkSMFAB4A8hAARAIIIFABABkKAjiAlDxFJQA4AkvyJIgI=",
      "fligtest",
      "gAAIZmxpZ3Rlc3SAgQEAaFkedAC68BP3ApHv6wyIEQwrxAmDBmCEwypQwaCBeMWFBKABiAAAAAAwyoA6KgEAjVkqkAAAEAEAAABgBGgA0AAYIoAGAFkqkTwAACIAAAAAjDKgjkkAQGOWAi4NxAiGEQIMGgBwWAUqGDQQLw72heEF",
      "jsonFileEdtrTests",
      "gAARanNvbkZpbGVFZHRyVGVzdHOAAQBoWLuAADATM/EMDw/DEBeYXKBygcsFUhdYXaB1gdcJI3CBwQUKFzhc4HWB1AVWF2idMDoX+Fwgc4HNBVoXeF0gdYHVCaNxgccFEhdYXGB1gdYFXhdInTAyF9hcoHOBzwVCFxhdoHSB0wkjcYHFBRoXeFxgdIHSBU4XCJ0wKhe4XCBygckFShc4XSB0gdEJo3CBwwUCFxhc4HSB0AVGFygB1xmapgQ=",
      "frame",
      "gAAFZnJhbWWAgQIAaFlSbgC6EBz5AqsP7CyAC+KEGBQWECSweGAAFI8KDogBIgUYFAIYBLDITFDBC4HD4HA4cACRyYANwAAJKpkBwAEAAAQYBLDITDDBC4HD4HA4cACRqWCFuCBOgEuhgcECigQEYEEFBcAAkUJcCgNOBY5hAA=="
    ];
    var  dbk = "/Deltarealm-b64-keys/", tmpShips = myShips, btns = GE(9);
    function shipJSON(uArr) {
      for (var i = 0, s = "", o = ship; i < uArr.length;)
        s += String.fromCharCode(uArr[i++]);
      if (!/^[!-~]*{/.test(s.slice(0, 1024)))
        return !0;
      try {
        o = JSON.parse(s);
        while (s = ["name", "gameVersion", "dateTime", ""][++i])
          if (typeof o[s] != "string")
            throw "Required string property: \"" + s + "\" in ship JSON";
        if (1 ^ o.blocks instanceof Array)
          throw "Required Array property: \"blocks\" in ship JSON";
        if (typeof (s = encodeCmprsShip()) == "string")
          throw s;
        tmpShips.push((ship = o).name, uint8arrayToBase64(s));
      } catch (err) {
        return !CMD.err(err);
      }
    }
    function addShip(i) {
      i && NG(btns);
      NG(btns, "button", {data: myShips[i++]}).onclick = function () {
        var s = this.nextSibling[iT] || ship;
        s = decodeCmprsShip(base64ToUint8array(s));
        if (typeof s === "string")
          return CMD.err(s);
        shipName.value = (ship = s).name;
        shipSize.childNodes[0].data = ship.blocks.length;
        drawShip(canW.value, canH.value, cBC.value);
      };
      NG(btns, "span", "", "none", {data: myShips[i++]});
    }
    function setupShips() {
      for (var ch = GE(9).childNodes, i = 0; ch[1];)
        GE(9).removeChild(ch[1]);
      for (myShips = tmpShips; i < myShips.length; i += 2)
        addShip(i);
    }
    // from CSV ship file v3.0 (has backward compatibility)
    function loadShipsCSV(uArr) {
      var b = 2, i = 0, j = 0, l = uArr.length, c, req, tmp = [];
      l > 64 ? l = 64 : 0;
      while (b) {
        if (uArr[i++] !== 34)
          break;
        req = --b ? [110, 97, 109, 101] : [100, 97, 116, 97];
        while (i < l && (c = uArr[i++]) !== 34)
          if (j < 4 && c !== req[j++])
            j = 0;
        c = uArr[i];
        if (j < 4 || ++i >= l || (b ? c !== 44 && c !== 59 : c !== 10))
          break;
      }
      if (i >= (l = uArr.length))
        return !0;
      b ? i = 0 : 0;
      while (i < l) {
        for (var s = ""; i < l && (c = uArr[i++]) !== 44 && c !== 59;)
          s += String.fromCharCode(c);
        if (i >= l)
          return !0;
        s = s.replace(/\\\\/g, "\\").replace(/\\c/g, ",");
        tmp.push(s.replace(/\\s/g, ";"));
        for (s = ""; i < l && (c = uArr[i++]) !== 44 && c !== 10;)
          if (c > 64 ?
            (c | 32) > 96 && (c | 32) < 123 :
            c < 58 ?
              c > 46 || c === 43 :
              c === 61)
            s += String.fromCharCode(c);
          else
            return !0;
        tmp.push(s);
      }
      tmpShips = tmp;
      setupShips();
    }
    var autoScroll = {toString: function () {
        var s = "autoScroll";
        CMD.log(s = "[object " + s +
          [" none]", " critical]", " all]"][CMD[s] = ++CMD[s] % 3]);
        return s;
      }
    };
    function aText(s) {
      for (var b = !0, i = 0, s_ = ""; i < s.length;) {
        for (; i < s.length && s[i] === '\n'; i++)
          if (b = !b)
            s_ += "\n";
        for (b = !1; i < s.length && s[i] !== '\n'; i++)
          s_ += s[i];
      }
      return s_;
    }
    CMDline.onkeyup = function (k) {
      var s = aText(CMDline[iT]), s_, st = null, df = "", o = ship;
      if (s.indexOf("\n") < 0)
        return;
      CMDline[iT] = s = s.replace(/\n/g, "");
      if (s.slice(0, 5) === "from:") {
        if ((s = localStorage.getItem(s.slice(5))) === null)
          return CMD.log("nonexisting slot");
        (o = decodeCmprsShip(base64ToUint8array(s))) ?
          ship = o :
          shipJSON(new Uint8Array(s.split("").map(function (e) {
              return e.charCodeAt(0);
            })));
        drawShip(canW.value, canH.value, cBC.value);
        shipName.value = ship.name;
        shipSize.childNodes[0].data = ship.blocks.length;
      } else if (s.slice(0, 3) === "to:")
        localStorage.setItem(s.slice(3), input.value ||
          JSON.stringify(ship));
      else if (s.slice(0,2) === "el") {
        CMD.log((st = D.querySelector(s.slice(3))).offsetHeight);
        df = (st = st.style).border;
        st.border = "1px white solid";
        setTimeout(function () {
          st.border = df;
        }, 3e3);
      } else if (s === "autoScroll")
        autoScroll.toString();
      else
        return CMD.log("expected `from:${id}` or `to:${id}` for loca\
lStora ge manipulation, `autoScroll` to dis/an-able it");
    }
    if (D.visibilityState !== UDF)
      D.onvisibilitychange = function reopen(e) {
        if (D.visibilityState === "visible")
          drawShip(canW.value, canH.value, cBC.value);
      }
    function init() {
      var delay = file.open.length = 0, el = GE(3);
      el.onclick = function () {
        if (delay < Date.now()) {
          file.input.click();
          delay = Date.now() + 900;
        }
      };
      (el = el[pN][pN]).ondragover = dragOver;
      el.ondrop = dragDrop;
      GE().onclick = function () {
        if (!input.value.length)
          return CMD.err("no base64 presented");
        var uArr = base64ToUint8array(input.value);
        if (typeof uArr === "string")
          return CMD.err(uArr);
        var r = decodeCmprsShip(uArr);
        if (typeof r === "string")
          return CMD.err(r);
        ship = r;
        shipName.value = ship.name;
        shipSize.childNodes[0].data = ship.blocks.length;
        drawShip(canW.value, canH.value, cBC.value);
      };
      GE().onclick = function () {
        fileOpener(shipJSON, "No ship JSON file chosen", function () {
          shipName.value = ship.name;
          shipSize.childNodes[0].data = ship.blocks.length;
          drawShip(canW.value, canH.value, cBC.value);
        }, this);
      };
      GE().onclick = function () {
        if (shipName.value)
          ship.name = shipName.value;
        var r = encodeCmprsShip(ship);
        if (typeof r === "string")
          return CMD.err(r);
        input.value = uint8arrayToBase64(r);
      };
      el = downl.nextSibling.firstChild;
      GE().onclick = function () {
        if (shipName.value)
          ship.name = shipName.value;
        else if (ship.name.indexOf("-edited") + 1)
          shipName.value = ship.name += "-edited";
        var w = 450, h = 600, s = shipName.value, dat, bl, t = "image/png";
        bl = new Blob([JSON.stringify(ship)], {type: "application/json"});
        toDownl = [URL.createObjectURL(bl)];
        downl.download = s + ".json";
        el.data = s + ".json +1";
        rClass(downl, "none");
        drawShip(w, h, cBC.value);
        dat = ctx.getImageData(0, 0, w, h).data;
        var i = 0, l = w * h, uint8clarr = new Uint8ClampedArray(l << 2);
        for (var from, to; i < l; i++) {
          from = i << 2;
          to = Math.floor((i) / w) + h * (w - (i % w)) << 2;
          for (var n = 4; n-- > 0;)
            uint8clarr[to++] = dat[from++];
        }
        canvas.width = h;
        canvas.height = w;
        ctx.putImageData(new ImageData(uint8clarr, h, w), 0, 0);
        bl = (bl = canvas.toDataURL(t)).slice(bl.indexOf(",") + 1);
        bl = new Blob([base64ToUint8array(bl)], {type: t});
        toDownl.push(s + ".png", URL.createObjectURL(bl));
        drawShip(canW.value, canH.value, cBC.value);
      };
      GE().onclick = function () {
        downl.href = toDownl.shift();
        if (toDownl.length) 
          return setTimeout(function (n) {
            el.data = downl.download = toDownl.shift();
            if (n = toDownl.length >> 1)
              el.data += " +" + n;
          }, 0);
        aClass(downl, "none");
        el.data = "no file to download";
      };
      setupShips();
      GE(19).onclick = function () {
        tmpShips = [];
        fileOpener(shipJSON, "No ship JSON files chosen", function () {
          setupShips();
        }, this, !0);
      };
      GE().onclick = function () {
        fileOpener(loadShipsCSV, "No csv ships file Chosen", F, this);
      };
      GE().onclick = function () {
        var s = shipName.value, v = encodeCmprsShip();
        if (typeof v === "string")
          return CMD.err(v);
        addShip(myShips.push(s ? s : ship.name, uint8arrayToBase64(v)) - 2);
      };
      // to CSV ship file v3.0
      GE().onclick = function () {
        for (var i = 0, c, s = ""; i < myShips.length;) {
          c = myShips[i++];
          c = c.replace(/\\/g, "\\\\").replace(/,/g, "\\c");
          s += c.replace(/;/g, "\\s") + ";";
          if (i < myShips.length)
           s += myShips[i++] + "\n";
        }
        s = "\"ship_name\";\"base64_data\"\n" + s;
        toDownl = [URL.createObjectURL(new Blob([s], {type: "text/csv"}))];
        s = input.value;
        s = s.length && s.length < 128 ? s.replace(/,/g, "") : "DltrShips";
        el.data = downl.download = s + ".csv";
        rClass(downl, "none");
      };
      var loading = 0, l_interv = -1, d_el = GE(26), l_el = GE();
      function docUnload() {
        setTimeout(function () {
          d_el.href = "";
          l_el[iT] = "Load file";
          aClass(d_el, "none");
          rClass(l_el, "none");
        }, 300);
      }
      function docLoad() {
        if (/^[A-Z]:|^file:|^content:/.exec(location))
          return CMD.warn("Already running local file :D");
        this[iT] = "Loading";
        l_interv = setInterval(function () {
          l_el[iT] = "Loading " + "-\\|/"[++loading & 3];
        }, 400);
        var xhr = new XMLHttpRequest();
        xhr.open("GET", location);
        xhr.onreadystatechange = function () {
          if (this.readyState !== 4)
            return;
          clearInterval(l_interv);
          if (!xhr.responseText) {
            l_el[iT] = "Try loading again";
            return CMD.err("file inavalible");
          }
          var bl = new Blob([xhr.responseText], {type: "text/plain"});
          d_el.childNodes[0].href = URL.createObjectURL(bl);
          aClass(l_el, "none");
          rClass(d_el, "none");
        };
        xhr.send();
      }
      l_el.onclick = docLoad;
      d_el.onclick = docUnload;
      ntsh();
      setDrShipEdtr();
      shipName.value = ship.name;
      shipSize.childNodes[0].data = ship.blocks.length;
      canW.value = 480;
      canH.value = 560;
      cBC.value = "#111133";
      GE(45).scrollIntoView(!0);
      if (!/^[A-Z]:|^file:|^content:/.exec(location) &&
        !localStorage.getItem(dbk))
        D.body[pN].scrollTop = 96;
      (function (e, p, o, n, w) {
        if ((n = e.offsetLeft + e[o]) - p[o] - 20 > 0)
          p.style.left = (e[o] - w > 0 ? n - e[o] : n - p[o] - 20) + "px";
        window.onresize = function resize() {
          if (w === innerWidth)
            return;
          p.style.left = 0;
          window.onresize = null;
        };
      })(GE(45), GE("info"), "offsetWidth", 0, innerWidth);
      i = GE(3)[pN].offsetHeight;
      if (i >= 41 && i <= 42) {
        aClass(GE(45), "corr0");
        aClass(GE(45), "corr1");
      }
      (function (si, m, s, uAg) {
        new RegExp(si + s + m + "|" + m + s + si, "i").test(uAg) &&
          aClass(GE(45), "corrs") == aClass(GE("info"), "corrs");
      })("samsungbrowser", "mobile", "[^]*", navigator.userAgent);
      for (var i = 0, ch = D.head.childNodes; i < ch.length; i++)
        if (ch[i].nodeName === "TITLE")
          ch[i].text = "Compressor - tool for Dealtarelm ship base64 keys";
    }
    if (!/^[A-Z]:|^file:|^content:/.exec(location))
      /bot\.html|Google-Inspect/.exec(navigator.userAgent) &&
        aClass(D.body, "still");
    D.head.appendChild(D.createComment(navigator.userAgent +
      JSON.stringify(navigator.userAgentData || {})));
    /^http[^]{18,19}o\/Deltarealm-b64-keys\/?$/.exec(location) ||
      NG(D.head, "link", ["rel", "canonical", "href", "https://kaabel.githu\
b.io" + dbk]);
    if (/^http:\/\/(?:\d+\.\d+\.\d+\.\d+|localhost:\d+)/.exec(location))
      window.WebSocket = function () {
        var e = window.onerror;
        window.onerror = function () {
          window.onerror = e;
        };
        throw ":P";
      };
    if (typeof langDetector == U)
      var langDetector = {onLanguageDetected: CMD.log};
    try {
      var swc = navigator.serviceWorker, sw = swc.controller;
      sw || swc.register(dbk + "service-worker.js",
        {scope: dbk}).then(function (swr) {
          sw = (swr.installing || swr.waiting || swr.active);
          (sw || {}).onstatechange = console.log;
        });
    } catch (e) {
      console.log(e, "sw_js");
    }

    function base64ToUint8array(base64) {
      var uint8array = [], buffer, i = 0, p = 0, c;
      for (; i < base64.length; i++) {
        c = base64.charCodeAt(i);
        if (c > 64)
          (c & 223) < 91 ? c -= c & 32 ? 71 : 65 : c = 128;
        else if (c < 58)
          c > 46 ? c === 47 ? c = 63 : c += 4 : c === 43 ? c = 62 : c = 128;
        else if (c === 61) {
          if (i & 2) {
            i & 1 ?
              i + 1 === base64.length ?
                p = 0 :
                c = 129 :
                i + 2 === base64.length && base64.charAt(i + 1) === "=" ?
                  p = !(i += 2) :
                  c = 137;
            buffer !== 0 ? c = 145 : 0;
          } else
            c = 130;
        } else
          c = 128;
        if (c & 128)
          return ["char", "padding", "padding char"][c & 7] + " error " +
            (c >> 3 & 3 ) + " : " + buffer + " pos.: " + i;
        buffer = (buffer << 6) | c;
        if (p) {
          uint8array.push(buffer >> (p -= 2) & 255);
          buffer &= 63 >> (i << 1 & 6);
        } else
          p = 6;
      }
      return new Uint8Array(uint8array);
    }

    function uint8arrayToBase64(uint8array) {
      var string = "", buffer, i = 0, p = 0, c;
      function codeChar() {
        return c < 52 ? c < 26 ? 65 : 71 : c < 62 ? -4 : c < 63 ? -19 : -16;
      }
      for (; i < uint8array.length; i++) {
        buffer = buffer << 8 | (c = uint8array[i]);
        if (p == 4) {
          c = buffer >> 6;
          string += String.fromCharCode(c + codeChar());
          c = buffer & 63;
          buffer = p = 0;
        } else {
          c = buffer >> (p += 2);
          buffer &= 15 >> (p & 2);
        }
        string += String.fromCharCode(c += codeChar());
      }
      if (p) {
        c = buffer << 6 - p;
        c += codeChar();
        string += String.fromCharCode(c) + (p & 4 ? "=" : "==");
      }
      return string;
    }
/** script with Dr functions (the "source code")
 * 
 * 'Layout is like:'
 *  - Graphics data for displaying function "drawShip"
 *  - (In VIP version editing functions: moveShip, rotateShip, filterBlocks)
 *  - Some overall functions: setDrShipEdtr (loads and displays default
 *    ship), saveShip, gShip (get ship), rotateBlock, drawShip
 * note: rotateBlock returns [face(axis), isOpposite(neg.), rotation]
 *   used for ship displaying and encoding/decoding
 *  - After drawShip it's last section encoding/decoding
 *  - Functions for encoding: sortShip, wBit (w = write), wBitsMSBfFast,
 *    wMSBfirst (bytes), wVersion
 *  - Encoding: encodeCmprsShip
 *  - Functions for decoding: gBit (g = get), gMSBfirst, gVersion,
 *    dateTime, gBlocksRotation
 *  - Decoding: decodeCmprsShip
 *  - Debug: binaryData, rotationIndex
 * 
 * VIP version is more unmodified version including drawShip and editing
 * functions to not provide ('my' powerfull) ship editor - key editing
 */
var i, j, buffer = new Uint8Array(), ship = decodeCmprsShip();
var NBID = JSON.parse("{\"0\":\"block\",\"1\":\"wedge\",\"2\":\"wedge_1x2\",\
\"3\":\"pyramid\",\"4\":\"pyramid_1x2\",\"5\":\"inverse_pyramid\",\"6\":\"in\
verse_pyramid_1x2\",\"7\":\"hydrogen_tank_small\",\"8\":\"rcs_rocket_thruste\
r_small\",\"9\":\"rocket_thruster_small\",\"10\":\"cockpit_fighter\",\"11\":\
\"cockpit_cruiser\"}"),
  DrSHIP_DAT = JSON.parse("{\"block\":{\"id\":0},\"wedge\":{\"id\":1},\"wedg\
e_1x2\":{\"id\":2},\"pyramid\":{\"id\":3},\"pyramid_1x2\":{\"id\":4},\"inver\
se_pyramid\":{\"id\":5},\"inverse_pyramid_1x2\":{\"id\":6},\"hydrogen_tank_s\
mall\":{\"id\":7},\"rcs_rocket_thruster_small\":{\"id\":8},\"rocket_thruster\
_small\":{\"id\":9},\"cockpit_fighter\":{\"id\":10},\"cockpit_cruiser\":{\"i\
d\":11}}");
function saveShip(name) {
  if (name === UDF) name = "";
  if (saveFile === UDF || typeof result === U)
    return "saveFile function unavalible";
  if (ship.name === UDF)
    return "ship not loaded";
  if (name)
    ship.name = String(name);
  else if (ship.name.indexOf("-edited") + 1)
    ship.name += "-edited";
  // old saveFile function / 
  var fileName = ship.name + ".json", fileType = "application/octet-stream";
  if (fileName === "" || fileType === "") {
    CMD.log("missing file name or type");
    return;
  } else {
    CMD.log("");
  }
  var fileContent = JSON.stringify(ship);

  var file = new Blob([fileContent], {type: fileType});
  let url = URL.createObjectURL(file);
  NG("a", ["href", url, "download", fileName]).click();
  setTimeout(function () {
    window.URL.revokeObjectURL(url);
  }, 0);
}

function setDrShipEdtr() {
  ship = decodeCmprsShip(base64ToUint8array("gAALU3RhcnRlclNoaXCAAQBnyR+wATj\
RE/MIg+/jGIhC4AC4AAgsIpEBBBAEDoFSLDKADKAEIFCSGTKAEQAAABClwmuwSAQAIUQIkAEAGAE\
AACghWoXSoJToICaAFiADAHBCYCgRSlIIIQC0ABkAgBMCWIQEEZlkABkAAAAnAAAAEQAACi9AC5A\
BAAAA4AQAQBVKgBYAQAYAAMAJAIA4VBApQAqQAQA4AQAgKwDIAACcAAAARAAAABBoATIAAAAAnAA\
A2AAQKAFaAAAZAAAAJwAA4lABtAAZAAAAJwAAJAUAGQAAACcAAAARAAAKDUALkAEAAADgBABAFU6\
AFgBABgAAwAkAgDiAAJACZAAATgAAyAsARgAAAECMCo1BIxEAhBAhQAYAYAQAAGCFWBVOg1Oig7g\
ALoAMAMAJsTCcCCcphBAXwAWQAQA4IRawCAkiYWQQhUABUAAQaEQiAwBBoBAoxSIDyABKAAIlTvi\
FogQ="));
  // used for testing graphics blocksRotatingTest("new_block");
  function blocksRotatingTest(block) {
    if (typeof block === U) block = "pyramid_1x2";
    ship = {name: "jsonFileEdtrTests", gameVersion: "0.1",
      dateTime: "screw your needs for time", blocks: Array(32)};
    for (var i = 0, b = ship.blocks; i < 64; i++) {
      b[i] = {
        "internalName": block,
        "position": [
          (i & 3) * 2 + (i >> 2 & 8) - 7,
          (i & 3) * 2 + (i >> 2 & 8) - 7,
          ((i & 28) >> 1) - 7
        ],
        "rotation": [
          (i >> 4) * 90,
          (i >> 2 & 3) * 90,
          (i & 3) * 90
        ],
        "properties": {}
      };
    }
    if (/cockpit/.exec(block))
      ship.blocks.forEach(function (b) {
        for (var n = 0; n < 3;)
          b.position[n++] *= 2;
      });
    b.length = 64;
  }
  if (typeof arguments[0] === "string")
    blocksRotatingTest(arguments[0]);
  drawShip(480, 560, "#111133");
}
function gShip(strarg_singlefile_input) {
  var v = arguments[0], s = "";
  if (typeof v === "string" && v)
    s = v;
  else if (v)
    if (typeof uint8array === U)
      return "uint8array undefined";
    else if (uint8array instanceof Uint8Array)
      for (var i = uint8array.length; i-- > 0;)
        s = String.fromCharCode(uint8array[i]) + s;
    else
      return "uint8array is not Uint8Array object";
  else
    s = input.value;
  try {
    ship = JSON.parse(s);
  } catch (err) {
    if (err)
      CMD.err(err.message + "\n\tJSON file required " + s.length);
    else
      aClass(canvas, "mrgn10");
  }
}
function rotateBlock(r) {
  // rotation, (angle → of axis)
  var i = 3, angle = [], rot = 0;
  // other/mirored side
  var face = 1, order, o_side = !1;
  r.forEach(function (el) {
    el = Math.round((el % 360) / 90);
    if (el < 0)
      el += 4;
    angle.push(el);
  });
  r = angle;
  switch (r[0]) {
    case 1:
      return [2, !0, r[1] + 4 - r[2] & 3];
    case 2:
      r[0] = 0;
      r[1] = r[1] + 2 & 3;
      r[2] = r[2] + 2 & 3;
      break;
    case 3:
      return [2, !1, r[1] + r[2] & 3];
  }
  while (i-- > 0)
    if (r[i]) {
      angle = r[i];
      if (i === 1)
        rot = (rot + angle) & 3;
      else {
        order = face === 0 + !i;
        if (angle & 1)
          face = order ? 2 : 0;
        if (angle + order > 1 && angle + order < 4)
          o_side = !o_side;
        switch (i) {
          case 1:
            if (angle !== 2)
              rot += angle;
          case 2:
            if (o_side === !0)
              rot = 2;
            break;
        }
      }
    }
  return [face, o_side, rot];
}
// display ship function
function drawShip(w, h, backg) {
  if (typeof ship !== "object")
    return "ship data required";
  canvas.width = w;
  canvas.height = h;
  var w_mid = w / 2 - 8, h_mid = h / 2 - 8, path, posX, posY;
  ctx.fillStyle = backg;
  ctx.fillRect(0, 0, w, h);
  // removed ship displaying
}
// sorts blocks by position x than y than z
function sortShip() {
  var i, l, n, vals, refs, b = ship.blocks, _b = [];
  if ((l = ship.blocks.length) > 0x7fffffff)
    return "too much blocks";
  vals = new Uint32Array(l);
  while (l-- > 0)
    for (i = 0; i < 3; i++) {
      n = b[l].position[i] + 511;
      if (n < 0 || n > 1023)
        return "block too far in axis " + "xyz"[i] + ", l: " + l;
      vals[l] = (vals[l] << 10) + n;
    }
  i = 0;
  refs = [];
  for (var u, d; i < vals.length; i++) {
    u = i;
    d = 0;
    while (u !== d) {
      n = u + d >> 1;
      if (vals[refs[n]] > vals[i])
        u = n;
      else if (vals[refs[n]] < vals[i])
        d = ++n;
      else
        break;
    }
    if (u === d) {
      for (d = refs.length; d > n; d--)
        refs[d] = refs[d - 1];
      refs[d] = i;
    }
  }
  for (i = refs.length; i-- > 0;)
    _b[i] = b[refs[i]];
  ship.blocks = _b;
  return ship;
}
function wBit(b) {
  if (b)
    buffer[i] |= 1 << j;
  else
    buffer[i] &= 255 - (1 << j);
  if (++j > 7) {
    i++;
    j = 0;
  }
}
function wBitsMSBfFast(l, n) {
  buffer[i] |= n << j;
  n >>= 8 - j;
  if (l + j > 8) {
    l -= 8 - j;
    j = 0;
    i++;
    while (l > 7) {
      buffer[i++] |= n;
      n >>= 8;
      l -= 8;
    }
    buffer[i] |= n;
    n >>= l;
  }
  j += l;
  buffer[i] &= 255 >> 8 - j;
  if (j > 7) {
    i++;
    j = 0;
  }
  // value of spare bits
  return n;
}
function wMSBfirst(l, n) {
  for (var i1 = i += l; l-- > 0; n >>= 8)
    buffer[--i1] = n & 255;
  return n;
}
function wVersion(arr) {
  for (var l = 0, m = 0, n = 64; !0;) {
    while (arr[l] >= n--)
      n = 64 << (m += 6);
    buffer[i++] = arr[l] >> m;
    while (m) {
      buffer[i - 1] |= 64;
      m -= 6;
      n >>= 6;
      buffer[i++] = (arr[l] & n) >> m;
    }
    if (++l < arr.length)
      buffer[i - 1] |= 128;
    else
      break;
  }
}

function encodeCmprsShip() {
  // version 0.0.3 (the existing prototype specification is for v.0.0)
  var l, n, id, p_i, chunkEnd, s, propertiesStr = "";
  var propertiesRef = [], b, arr, min, max, prev, size = [], sizeB = [];
  var rot = [], kB;
  // id length
  var IDLEN = 4;
  i = j = 0;
  buffer = new Uint8Array(1040);
  // array of pointers to arrays with kBs of file (1024 + buffer of 16 bytes)
  kB = [buffer];
  // data block: compression version
  wVersion([0, 0, 3]);
  // data block: name
  buffer[i++] = l = ship.name.length;
  if (l > 255)
    CMD.warn("too long name (" + l + ") set to: " + (l = 255));
  for (n = 0; n < l;) {
    s = ship.name.charCodeAt(n++);
    buffer[i++] = s > 31 && s < 127 || s > 8 && s < 11 ? s : 63;
  }
  // data block: game version
  arr = JSON.parse("[" + ship.gameVersion.replace(/\./g, ",") + "]");
  wVersion(arr);
  for (l = 0; l < 3 && arr.length; l++)
    if (arr[l] > [0, 1, 2][l])
      CMD.warn("unknown game version");
  // data block: date and time (seconds from  26.1.2022 16:48 UTC)
  wMSBfirst(4, Date.now() / 1e3 - 1643215695);
  // data block: blocks
  sortShip();
  b = ship.blocks;
  // blocks length
  wBit(n = (l = b.length) > 8191);
  wBitsMSBfFast(n ? 21 : 13, l);
  if (!l) {
    CMD.log("empty ship (no blocks)");
    if (j)
      i++;
    arr = new Uint8Array(i);
    while (i-- > 0)
      arr[i] = buffer[i];
    return arr;
  }
  // ID bit length (3 bits) + 4 (IDLEN)
  wBitsMSBfFast(3, 0);
  arr = b[--l].position;
  min = [arr[0], arr[1], arr[2]];
  max = [arr[0], arr[1], arr[2]];
  while (l-- > 0) {
    arr = b[l].position;
    for (n = 0; n < 3; n++)
      if (arr[n] > max[n])
        max[n] = arr[n];
      else if (arr[n] < min[n])
        min[n] = arr[n];
  }
  // pairs min and max blocks positions in each axis - xyz
  for (n = 0, l = 6; n < 3; ++n > 1 ? l = 8 : 0) {
    if (wBitsMSBfFast(l, min[n] + (1 << l - 1) - 1))
      return "ship too far in axis: " + "xyz"[n];
    if (wBitsMSBfFast(l, max[n] + (1 << l - 1) - 1))
      return "ship too far in axis: " + "xyz"[n];
  }
  function fixedBlock(block) {
    // ID
    wBitsMSBfFast(IDLEN, id = DrSHIP_DAT[block.internalName].id);
    // position
    wBitsMSBfFast(8, block.position[2] + 127);
    wBitsMSBfFast(6, block.position[1] + 31);
    wBitsMSBfFast(6, block.position[0] + 31);
    // rotation
    var r = rotateBlock(block.rotation);
    wBitsMSBfFast(5, r = r[2] | r[1] << 2 | r[0] << 3);
    // are properties?
    checkProperties(block.properties);
    rot[id] = r;
    if (j) {
      i++;
      j = 0;
    }
  }
  function endings() {
    // handles chunk endings, kB borders or both
    if (i > chunkEnd) {
      prev = [i, j, 0];
      n = i = chunkEnd + 8;
      j = 0;
      // six bits after chunkending
      wBitsMSBfFast(6, (chunkEnd << 3) + 7 - p_i);
      fixedBlock(b[l]);
      n = i - n;
      i = chunkEnd + 1;
      j = i + n;
      chunkEnd += n + 512;
      while(i < j) {
        buffer[i + n] = buffer[i];
        buffer[i] = buffer[i + 7];
        buffer[i + 7] = 0;
        i++;
      }
      i = prev[0] + n;
      j = prev[1];
      for (n = 1 << IDLEN; n-- > 0;)
        rot[n] = 8;
    }
    if (i > 1023) {
      prev = buffer;
      buffer = new Uint8Array(1040);
      p_i -= 1024;
      chunkEnd -= 1024;
      i -= 1024;
      for (n = 0; n < 16; n++)
        buffer[n] = prev[n | 1024];
      kB.push(buffer);
    }
  }
  function checkProperties(prpt) {
    var p, s = JSON.stringify(prpt);
    // Has properties
    wBit(s !== "{}");
    if (s !== "{}")
      if (p = propertiesStr.indexOf(s) + 1)
        // stores properties for later
        propertiesRef.push(p, s.length);
      else {
        propertiesRef.push(propertiesStr.length, s.length);
        propertiesStr += s;
      }
  }
  // sets up ship sizes and relative rotations
  for (n = 3; n-- > 0; sizeB[n] = l) {
    size[n] = max[n] - min[n] + 1;
    for (l = 8, s = 128; size[n] < s; --l)
      s >>= 1;
  }
  for (n = 1 << IDLEN; n-- > 0;)
    rot[n] = 8;
  // first block (fixed)
  fixedBlock(b[0]);
  // previous i
  p_i = i << 3;
  chunkEnd = i + 511;
  // relative blocks string
  for (l = 1, arr = b[0].position; l < b.length; l++) {
    p_i = (i << 3) + j;
    // ID
    wBitsMSBfFast(IDLEN, id = DrSHIP_DAT[b[l].internalName].id);
    // relative position
    prev = [arr[0], arr[1], arr[2]];
    arr = b[l].position;
    n = 2;
    s = arr[n] - prev[n] - 1;
    if (s < 0) {
      s += size[n];
      prev[1]++;
    }
    wBit(s);
    if (s)
      wBitsMSBfFast(sizeB[n], s - 1);
    while (n-- > 0) {
      // relative y and x position
      if (arr[n] < prev[n]) {
        if (n < 1)
          return "weird error";
        else
          s = arr[n] + size[n] - prev[n];
        prev[0]++;
      } else
        s = arr[n] - prev[n];
      wBit(s);
      if (s)
        wBitsMSBfFast(sizeB[n], s - 1);
    }
    // optionaly relative rotation
    n = rotateBlock(b[l].rotation);
    n = n[2] | n[1] << 2 | n[0] << 3;
    wBit(s = rot[id] !== n);
    if (s)
      wBitsMSBfFast(5, n);
    rot[id] = n;
    checkProperties(b[l].properties);
    endings();
  }
  if (j)
    i++;
  chunkEnd = i - 1;
  // last/ending chunk
  // only if proceeding relative chunk??! unsure
  --l && endings();
  // data block: properties
  if (propertiesRef.length) {
    // just indexes and lengths of JSON strings
    s = JSON.stringify([propertiesRef, propertiesStr]);
    for (n = 0; n < s.length;) {
      buffer[i++] = s.charCodeAt(n++);
      if (n > 1023) {
        kB.push(buffer = new Uint8Array(1040));
        i = 0;
      }
    }
  }
  // joins binary data of required length to one file
  buffer = new Uint8Array((kB.length - 1 << 10) + i);
  for (j = l = 0; l < buffer.length; kB[j++] = []) {
    (n = buffer.length - l) > 1023 ? n = 1024 : 0;
    arr = kB[j];
    for (i = 0; i < n;)
      buffer[l++] = arr[i++];
  }
  return buffer;
}

function gBit() {
  var b_int = (buffer[i] & 1 << j) >> j;
  if (++j > 7) {
    j = 0;
    i++;
  }
  return b_int;
}
function gMSBfirst(l) {
  var n = 0;
  while (l-- > 0)
    n = n * 256 + buffer[i++];
  return n;
}
function gBitsMSBfFast(l) {
  var mj = j, b_int = !1;
  if (l + j > 8) {
    b_int = buffer[i++] & 255 << j;
    l -= 8 - j;
    j = 8;
    while (l > 8) {
      b_int += (buffer[i++] << j);
      l -= 8;
      j += 8;
    }
    b_int += (buffer[i] & 255 >> (8 - l)) << j;
  } else
    b_int += buffer[i] & 255 >> (8 - l) << j;
  b_int >>= mj;
  if ((j = (j & 7) + l) > 7) {
    i++;
    j = 0;
  }
  return b_int;
}
function gVersion() {
  var version = [], n = 0;
  i--;
  do {
    version.push(0);
    do {
      version[n] = (version[n] << 6) + (buffer[++i] & 63);
    } while (buffer[i] & 64);
    n++;
  } while (buffer[i] & 128);
  i++;
  return version;
}
function dateTime(t) {
  if (typeof t !== "number")
    t = Math.floor(Date.now() / 1e3);
  var i = 0, n, s, months = [30, 27, 30, 29, 30, 29, 30, 30, 29, 30, 29, 30];
  n = t % 60 | 0;
  s = ":" + (n < 10 ? "0" + n : n);
  n = (t = Math.floor(t / 60)) % 60;
  s = ":" + (n > 9 ? n : "0" + n) + s;
  s = " " + (t = Math.floor(t / 60)) % 24 + s;
  n = Math.floor(t / 24);
  t = Math.ceil(n % 365.25);
  if (t === 365 && !(n / 365.25 & 2))
    return "01.01." + Math.floor(n / 365.25 + 1971) + s;
  s = "." + (n / 365.25 + 1970 | 0) + s;
  if (n % 1461 > 788)
    t--;
  while (t > months[i])
    t -= months[i++] + 1;
  s = "." + (++i > 9 ? i : "0" + i) + s;
  t += 1 + (n % 1461 === 789);
  return (t > 9 ? "" : "0") + t + s;
}
// rotation by 5 bit index
function gBlockRotation(n) {
  if (n > 23)
    return "invalid input";
  var arr = [0, 0, 0];
  arr[(n < 8) << 1] = [90, 270, 0, 180, 270, 90][n >> 2];
  arr[n & 16 ? 2 : 1] = (
    n & 4 && (n & 16 ? n & 1 : !(n & 8)) ?
      n + 2 & 3 :
      n & 3
  ) * 90;
  return arr;
}
function decodeCmprsShip(cmprsShip) {
  // version 0.0.1! the existing prototype specification is for v.0.0
  var n = 0, l, pl, chunkEnd, id, IDLEN, BLEN, s = "", arr = [];
  var prev = [], b = [], min = [],  max = [], size = [], sizeB = [];
  var rot = [], properties = [], obj, ship = {}, p_i;
  i = j = 0;
  if (cmprsShip !== UDF)
    buffer = cmprsShip;
  // data block: compression version (and check)
  arr = gVersion();
  while (n < 2)
    if (arr[n++] > 0)
      return "unknown file vesrion";
  // data block: name
  l = buffer[i++];
  while (l-- > 0)
    s += String.fromCharCode(buffer[i++]);
  ship.name = s;
  // data block: game version
  ship.gameVersion = gVersion().join(".");
  // data block: date and time
  // ...of compression as I don't have date and time parse
  s = dateTime(gMSBfirst(4) + 1643215695);
  ship.dateTime = "compressed: " + s + " UTC";
  // data block: blocks
  // blocks length
  BLEN = gBitsMSBfFast(gBit() ? 21 : 13);
  ship.blocks = b;
  if (!BLEN) {
    if (i > buffer.length)
      return "unexpected end of data";
    CMD.log("read empty ship (no blocks)");
    return ship;
  }
  // ID bit length
  IDLEN = gBitsMSBfFast(3) + 4;
  // min max positions
  for (n = 0, l = 6; n < 3; ++n > 1 ? l = 8 : 0) {
    min[n] = gBitsMSBfFast(l);
    max[n] = gBitsMSBfFast(l);
    min[n] -= (1 << l - 1) - 1;
    max[n] -= (1 << l - 1) - 1;
  }
  function fixedBlock(b) {
    if (typeof b === U) b = !0;
    var obj = {}, dir;
    // ID
    obj.internalName = NBID[id = gBitsMSBfFast(IDLEN)];
    // position
    obj.position = arr = [];
    arr[2] = gBitsMSBfFast(8) - 127;
    arr[1] = gBitsMSBfFast(6) - 31;
    arr[0] = gBitsMSBfFast(6) - 31;
    // rotation
    obj.rotation = gBlockRotation(dir = gBitsMSBfFast(5));
    obj.properties = {};
    // has properties
    if (gBit() && b)
      properties.push(obj.properties);
    if (b) {
      prev = arr;
      rot[id] = dir;
    }
    if (j) {
      i++;
      j = 0;
    }
    return obj;
  }
  function relativeBlock() {
    p_i = (i << 3) + j;
    var obj = {}, dir;
    // ID
    obj.internalName = NBID[id = gBitsMSBfFast(IDLEN)];
    // relative x position
    obj.position = arr = [prev[0], prev[1], prev[2]];
    arr[2] += gBit() ? gBitsMSBfFast(sizeB[2]) + 2 : 1;
    if (arr[n = 2] > max[2]) {
      arr[2] -= size[2];
      arr[1]++;
    }
    while (n-- > 0) {
      // relative y and z positions
      arr[n] += gBit() ? gBitsMSBfFast(sizeB[n]) + 1 : 0;
      if (arr[n] > max[n]) {
        if (n < 1)
          return "blocks doesn't fit in box";
        arr[1] -= size[1];
        arr[0]++;
      }
    }
    // optionaly relative rotation
    dir = gBit() ? gBitsMSBfFast(5) : rot[id];
    obj.rotation = gBlockRotation(dir);
    obj.properties = {};
    // has properties
    if (gBit() && i < chunkEnd)
      properties.push(l);
    if (i + !!j > chunkEnd)
      return;
    prev = arr;
    rot[id] = dir;
    b[l] = obj;
  }
  function chunkEnding() {
  // handles chunk ends
    var n_0, n_1, buf_0;
    if (n_0 = i + !!j > chunkEnd) {
      i = chunkEnd;
      j = 0;
    }
    if ((--chunkEnd << 3) + 7 - p_i !== gBitsMSBfFast(6)) {
      b[l = b.length = ++pl] = obj = fixedBlock();
      CMD.warn("corrupted chunk: " + (p_i >> 13));
    } else
      obj = fixedBlock(!1);
    n = rotateBlock(obj.rotation);
    obj.rotation = gBlockRotation(n[2] | n[1] << 2 | n[0] << 3);
    n_1 = i;
    if (n_0) {
      buf_0 = buffer;
      buffer = [];
      i = n_0 = p_i >> 3;
      j = p_i & 7;
      for (n = 0; i <= chunkEnd;)
        buffer[n++] = buf_0[i++];
      for (i = n_1; n < 8;)
        buffer[n++] = buf_0[i++];
      i = 0;
      relativeBlock();
      i += n_0 + n_1 - chunkEnd - 1;
      buffer = buf_0;
    }
    chunkEnd = n_1 + 512;
    if (JSON.stringify(obj) !== JSON.stringify(b[l])) {
      BLEN -= l - ++pl;
      b[l = b.length = pl] = obj;
      CMD.warn("corrupted chunk: " + (p_i >> 13));
      prev = obj.position;
    }
    for (n = 1 << IDLEN; n-- > 0;)
      rot[n] = 8;
  }
  // sets up ship sizes and relative values
  for (n = 3; n-- > 0; sizeB[n] = l) {
    size[n] = max[n] - min[n] + 1;
    for (l = 8, s = 128; size[n] < s; --l)
      s >>= 1;
  }
  for (n = 1 << IDLEN; n-- > 0;)
    rot[n] = 8;
  // first block
  b[pl = l = 0] = fixedBlock();
  p_i = i << 3;
  chunkEnd = i + 512;
  while (++l < BLEN) {
    // " && i < chunkEnd" === bugfix (v0.0.1 update) for BjjI bug
    if (s = relativeBlock() && i < chunkEnd)
      return s;
    if (i >= chunkEnd)
      if (s = chunkEnding())
        return;
  }
  if (j) {
    i++;
    j = 0;
  }
  chunkEnd = i;
  l--;
  // last/ending chunk
  chunkEnding();
  // data block: properties
  if (l = properties.length) {
    for (s = ""; i < buffer.length;)
      s += String.fromCharCode(buffer[i++]);
    if (buffer[--i] !== 93)
      return "unexpected end of data";
    try {
      arr = JSON.parse(s);
    } catch (err) {
      if (err) {
        CMD.err(err);
        return ship;
      }
    }
    s = arr[1];
    arr = arr[0];
    for (i = l - 1 << 1; --l > 0; i -= 2) {
      obj = JSON.parse(s.slice(arr[i], arr[i] + arr[i | 1]));
      b[properties[l]].properties = obj;
    }
  }
  return ship;
}
// function used for debugging encode/decode
function binaryData($help) {
  if (typeof $help === "boolean")
    return "args: ArrayBuffer | Array (data), ?[?from, to] (slice), ?b\
      ytesize, ?isMSBF=false :displays data in bits(for viewing data)";
  var i = 1, j = 0, l, bs, bit = 1, s, slice = [0], a = arguments;
  if (a[1] instanceof Array && a[1].length) {
    i++;
    if (a[1].length > 1)
      slice[0] = a[1].shift();
    slice.push(a[1][0]);
  }
  if (typeof a[0].BYTES_PER_ELEMENT === "number")
    bs = a[0].BYTES_PER_ELEMENT << 3;
  else if (!(a[0] instanceof Array) || typeof a[i] !== "number")
    throw new TypeError("requires ArrayBuffer or Array and bytesize");
  if (slice.length < 2)
    slice.push(a[0].length);
  if (typeof a[i] === "number")
    bs = a[i++] << 3;
  if (typeof a[i] === "boolean" && a[i])
    for (i = slice[0], l = slice[1], s = "BigEndian " + i + ":"; 1;) {
      for (j = 0; j < bs; s += j & 7 ? "" : " ")
        s += a[0][i] & 1 << bs - ++j ? "1" : "0";
      if (++i >= l)
        return s;
      s += i + ":";
    }
  // bits are ordered as they are read be decoding
  for (i = slice[0], l = slice[1], s = "LSbitF+LE! " + i + ":"; 1;) {
    for (j = 0, bit = 1; j++ < bs; bit <<= 1)
      s += (a[0][i] & bit ? "1" : "0") + (j & 7 ? "" : " ");
    if (++i >= l)
      return s;
    s += i + ":";
  }
}
// function for manual use to check rotations or/and rotation index
function rotationIndex(arr) {
  arr = rotateBlock(arr);
  arr = arr[2] | arr[1] << 2 | arr[0] << 3;
  var r = gBlockRotation(arr);
  return [r[0], r[1], r[2], arr];
}
  </script>
</body>
</html>
<!-- #prayForUkraine -->
